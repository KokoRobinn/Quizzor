<!DOCTYPE html>
<html>
<head>
    {{$quiz := .Quiz}}
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
		.center {
            margin: 0;
            position: absolute;
            top: 50%;
            left: 50%;
            -ms-transform: translate(-50%, -50%);
            transform: translate(-50%, -50%);
		}
        .page {
            background: #c0c0c0;
            border: 3px solid #d0d0d0;
	    	padding: 10px;
            width: 50vmax;
    	    height: 25vmax;
       	}
    </style>
</head>
<body>
    <div class="page center">
    {{if lt $quiz.Question_index 0}}
    <!--Welcome screen-->
        <h1>Welcome to quiz {{$quiz.Name}}</h1> 
        code: {{$quiz.Code}} <br>
        players: <br>
        {{range $p := $quiz.Players}}
            <div> &ensp;&ensp;&ensp;&ensp; {{$p.Name}} </div>
        {{end}}
    {{else}}
        <!--Question screen-->
        {{$question := index $quiz.Questions $quiz.Question_index}}
        <h1>Question {{$quiz.Question_index}}</h1>
        <form method="POST">
        <p>{{$question.Text}}</p>
        {{if $question.Options}}
        <!--Radio button select-->
        {{range $o := $question.Options}}
        <input type="radio" id="{{$o}}" name="answer" value="{{$o}}">
        <label for="{{$o}}">{{$o}}</label><br>
        {{end}}
        {{else}}
        <!--Free text (WIP)-->
        <input type="text" placeholder="Write an answer..." name="free-text">
        {{end}}
        <button type="submit">Submit</button>
        </form>
        <p style="visibility: hidden;">Answer submitted</p>
    {{end}}
    <form method="POST">
        <input name="progress" value="progress">
        <button type="submit">{{if lt $quiz.Question_index 0}}Start Quiz{{else}}Next Question{{end}}</button>
    </form>
    </div>
<script>
    const output = document.getElementById('output');
    const source = new EventSource('/events/{{$quiz.Code}}');

    source.onmessage = (event) => {
        if (event.data == "update") {
            location.reload();
        }
        //const el = document.createElement('p');
        //el.textContent = event.data;
        //output.appendChild(el);
        //output.scrollTop = output.scrollHeight;
    };

    source.onerror = (err) => {
        console.error('EventSource failed:', err);
    };
</script>
</body>
</html>